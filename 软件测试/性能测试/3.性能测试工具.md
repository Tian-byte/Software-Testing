# 主流的性能测试工具

- Loadrunner
- JMeter

Loadrunner 是一种工业级标准性能测试负载工具，可以模拟上万用户实施测试，并在测试时可实时检测应用服务器及服务器硬件各种数据，来确认和查询存在的瓶颈

采用c语言编写

支持多种协议 web http html windows sockets ftp odbs ms sql server 等协议

优点：

- 多用户（支持用户以完为单位）
- 详细的分析报表（以秒为单位）
- 支持ip欺骗功能

确定：

- 收费
- 体积庞大（安装包单位GB)
- 无法定制功能



**JMeter** 

- JMeter 是Apache 组织开发的基于Java的开源软件，用于对系统功能测试和性能测试
- 他最初设计用于web应用测试，但后来扩展到其他领域，例如 静态文件 java程序，shell脚本，数据库，FTP,Mail等

优点：

- 开源免费
- 小巧（安装包50mb左右）
- 丰富的学习资料和扩展组织

缺点：

- 不支持ip欺骗
- 分析和报表能力相对与Loadrunner欠缺精度（以分钟为单位）





# Jmeter 基本使用



### Jmeter 基本使用

1. 安装JDK 
2. 安装Jmeter

jmeter常见的文件目录介绍  

bin目录：存放可执行文件和配置文件

docs目录： 是JMeter 的api文档，用于开发扩展组件

printable_docs目录：用户开发帮助手册  

lib目录：存放JMeter 依赖的jar 包和用户扩展所依赖的jar包 -lib/ext包下



### Jmeter 元件和组件

元件的基本介绍：
元件：多个类似功能组件的容器（类似于类）



![image-20240911182540799](E:\Software-Testing\软件测试\接口测试\img\image-20240911182540799.png)





- 取样器  发送请求
- 逻辑控制器  控制语句的执行顺序
- 前置处理器  对参数请求进行预处理
- 后置处理器  对响应结果进行提取
- 断言  检查接口的返回是否与预期结果一致
- 定时器  设置等待
- 测试片段  封装一段代码，供其他脚本调用
- 配置元件   测试数据的初始化配置
- 监听器 查看Jmeter脚本的运行结果



组件的基本介绍：

组件： 实现独立的某个功能（类似于方法）

例如：取样器的组件



元件于组件

元件：多个类似功能组件的容器（类似于类）

组件： 容器中实现独立的某个功能（类似于方法）



### Jmeter 元件作用域和执行顺序

元件的作用域： 是靠测试计划的树形结构中元件的父子关系来确定的

提示：所有的组件都是以取样器为核心来运行的，组件添加的位置不同，生效的取样器也不同

元组的作用域

- 取样器：核心，不和其他元件相互作用，没有作用域
- 逻辑控制器：只对其子节点中的取样器和逻辑控制器起作用
- 其他元组：
  - 如果是某个取样器的子节点，则该元件只对其父节点起作用
  - 如果其父节点不是取样器，则其作用域是该元件父节点下的其他所有后代节点（包括子节点，子节点的子节点等等）

### Jmeter 元件作用域和执行顺序

元件的执行顺序

1. 配置元件（初始化数据）
2. 参数赋值（前置处理器）
3. 定时器 
4. 发送请求（取样器）
5. 收响应（后置处理器）
6. 断言
7. 结果（监听器）



### JMeter使用示例

JMeter第一个案例

需求：使用JMeter访问百度首页接口，并查看请求和响应信息

步骤：

- 启动JMeter
- 在'测试计划' 下添加'线程组'
- 在'线程组'下添加'http请求'取样器
- 填写'http'请求的相关请求数据
- 在'线程组'下添加'察看结果树'监听器
- 点击'启动'按钮运行，并查询看结果

![image-20240911215747441](E:\Software-Testing\软件测试\接口测试\img\image-20240911215747441.png)

### JMeter 使用示例  -线程组

作用： 线程组就是控制JMeter 用于执行测试的一组用户

位置：右键点击'测试计划' --> 添加 --> 线程（用户）  - -> 线程组

特点：

- 模拟多人操作
- 线程组可以添加多个，多个线程组可以并行和串行
- 取样器（请求） 和 逻辑控制器必须依赖线程组才能使用
- 线程组下可以添加其他元件下组件

线程组的分类：

- 线程组
  - 模拟用户，支持多用户操作
  - 多个线程组可以串行执行，也可以并行执行
- 线程组的分类
  - setUp线程组
    - 前置处理 初始化的操作
  - 普通线程组
    - 编写脚本
  - tearDown线程组
    - 后置处理  环境恢复等

###  线程组配置（详细）

![image-20240911223734181](E:\Software-Testing\软件测试\接口测试\img\image-20240911223734181.png)

联系：

- 模拟10个用户并行执行
- 模拟10个用户5s内启动完成
- 模拟2个用户各循环3次
- 模拟2个用户运行30s
- 模拟2个用户等待10s后开始执行



案例：使用1个线程组，添加http请求（百度）

- 配置线程数为2 循环次数3时，运行观察结果
- 配置线程数为3 循环次数2时，运行观察结果，对比是否有不同

相同点：从请求数量来说，是完全相同的

不同点：场景不同

- 线程数：代表用户数，即性能测试的负载量（线程数为2比线程数为3对应的负载量小）
- 循环次数: 代表时间，即性能测试时的运行时间（循环次数3比循环次数2对应的事件长）

### JMeter -- HTTP请求

作用：向服务器发送http及https

参数：

![image-20240911231446669](E:\Software-Testing\软件测试\接口测试\img\image-20240911231446669.png)

![image-20240911232203527](E:\Software-Testing\软件测试\接口测试\img\image-20240911232203527.png)

案例：get请求访问百度  http://www.baidu.com/S?wd=test

要求：使用http请求  - 路径来传递get请求传递参数

HTTP响应数据中存在乱码，需要修改取样器结果的编码格式



# JMeter 参数化	

本质：使用参数的方式来替代脚本中的测试数据

实现方法： 

- 文件定义的方式
- 数据库的方式
- 定义变量

参数化测试：把测试数组织起来，用不同的测试数据调用相同的测试方法

JMeter 中常见的参数化方法：

- 用户定义的变量
- 用户参数
- CSV Data Set Config
- 函数

JMeter 参数化--- 用户定义的变量

- 作用：定义全局变量
- 位置： 测试计划  -》 线程组 -》 配置元件 -》 用户定义的变量
- 参数：



例：请求：https://www.baidu.com:443

要求：使用用户定义的配置被测系统的协议，域名和端口

- 操作步骤
  - 添加线程组
  - 添加用户定义的变量 ${}
  - 添加http请求
  - ![image-20240912113408143](E:\Software-Testing\软件测试\接口测试\img\image-20240912113408143.png)

![image-20240912113435482](E:\Software-Testing\软件测试\接口测试\img\image-20240912113435482.png)



### JMeter 参数化   - 用户参数

作用：针对一组参数，当不同的用户来访问时，可以获得到不同的值

- 什么时候使用用户参数化？
  - 针对同一组数据，当不同的用户来访问时，可以获取到不同的值
- 使用“用户参数”进行参数化的步骤？
  - 第一列添加多个变量名
  - 后续每列添加多个变量名
- 添加http请求 引入定义的变量名。格式${变量名}

### JMeter 参数化  -csv 数据文件设置

作用：不同的用户在多次循环时，可以取到不同的值

位置： 测试计划  - 线程组 - 配置元件  - csv数据文件设置

参数：![image-20240912120822766](E:\Software-Testing\软件测试\接口测试\img\image-20240912120822766.png)

- 什么时候使用csv数据文件设置？
  - 当不同的用户，或者同一个多用户多次循环时，都可以获取到不同的值
- 使用CSV数据文件设置“进行参数化的步骤
  - 定义csv数据文件
  - 添加线程组
  - 添加csv数据文件的设置
  - 引用http请求，引用定义的变量名，格式：${变量名}



### JMeter 参数化  函数（_counter)

作用：计数函数，一般做执行次数统计使用

位置：在菜单中选择  -》 选项  - 》 函数助手对话框

![image-20240912123801181](E:\Software-Testing\软件测试\接口测试\img\image-20240912123801181.png)

设置：

- TRUE 每个用户有自己的计数器，False 使用全局计数器
- Name of variable in which to store the result (optional):用户存储结果的变量名（可选）



例如：请求：访问百度首页  http://www.baidu.com/S?num=1

​	要求：每个用户每次执行该脚本都可以使用不同的值

操作步骤：

- 添加线程组 设置虚拟用户数和循环次数
- 生成__counter 函数
- 添加http请求，使用__counter 函数
- 添加查询结果树





1. 什么时候使用__counter 函数
   - 自动生成不重复的数据，让每个用户每次循环都能取到不同的额数据，且不需要提前定义
2. 使用__counter函数 进行参数化的步骤？
   - 添加线程组，设置虚拟用户数和循环次数
   - 生成__counter 函数
   - 使用http请求  使用__counter 函数。格式${____counter(FALSE,)}
   - 添加结果树



例：某支付系统 需要1000个不同的用户登录，并使用添加不同的测试金额访问支付接口？

- 添加线程组
- 添加配置元件 - csv数据文件设置，读取csv文件数据中的用户名密码
- 添加http请求 - 登录  引用csv数据文件设置中的变量
- 添加http 请求支付  使用counter函数传入不同金额的测试数据
- 添加查看结果树



# JMeter 断言

断言： 让程序自动断言 预期结果和实际结果是否一致

提示：

- jMeter 在请求的返回层前面有一个自动判断机制（响应状态码）
- 但是请求成功了，并不代表结果一定正确，因此需要检验机制提高测试准确性

JMeter 常见的断言

- 响应断言   对任意格式的响应数据进行断言
- JSON断言   对json 格式进行断言
- 持续事件断言（Duration Assertion)   对响应时间进行断言



### JMeter断言  -响应断言

作用：对HTTP请求的任意格式响应结果进项断言

位置：  测试计划  -  线程组 - http请求   -  右键添加  断言  -- 响应断言



![image-20240912160343236](E:\Software-Testing\软件测试\接口测试\img\image-20240912160343236.png)

参数配置详细介绍

测试字段： 要检查的项（实际结果）

- 响应文本  来自服务器的响应文本，即主体
- 响应代码 响应状态码 例如200
- 响应信息  响应的信息   ok
- Response Headers  响应头部
- Request   hearders  请求头
- Request   Data    请求数据
- URL样本   请求URL
- Document(text)  响应的整个文档
- 忽略状态： 忽略返回的响应状态码

模式匹配规则：比较偏方式

- 包括：文本包含指定的正则表达式
- 匹配： 整个文本匹配指定的正则表达式
- equals  等于
- substring  包含
- 否  取反
- 或者  有多个结果任意满足一个



联系  https://www.baidu.com  让程序检查响应数据中是否包含”百度一下  你就知道了“

### JSON断言

作用：对http请求的json格式的响应结果进行断言

位置： 测试计划   - 线程组 -http请求  -  断言 - json 断言

![image-20240912162348206](E:\Software-Testing\软件测试\接口测试\img\image-20240912162348206.png)

参数介绍：

- Assert JSON Path exists  用于断言的json元素的路径（实际结果）
- Additionally  assert value: 如果您想要某个值生成断言  请选择复选框
- Match as regular expression   使用正则表达式断言
- Expected Value 期望值（期望结果）
- Expect null   如果希望为空  请选择复选框】
- Invert assertion (will fail if above conditions met): 反断言（如果满足以上条件则失败）

 案例： 请求： http://www.weather.com.cn/data/sk/101010100.html

### JMeter 断言  - 断言持续的时间

作用：检查HTTP请求的响应时间是否超出要求的范围

![image-20240912164410410](E:\Software-Testing\软件测试\接口测试\img\image-20240912164410410.png)

参数介绍

- 持续时间（毫秒） http请求运行的最大响应时间（单位 毫秒） 超过则认证失败

练习：

请求：https://www.jd.com

检查：让程序检查响应时间是否大于100毫秒



# JMeter 关联

关联： 当请求之间有依赖关系，比如一个请求的参数是另一个请求返回的数据，这时候就需要用到关联处理

JMeter 中常用的关联方法：

- 正则表达式提取器
- XPath提取器   提取html格式的数据
- Json提取器

正则表达式

公式格式：左边界（匹配符号） 右边界： 可以提取出想要获取的数据内容

- .    : 是通配符 可以代表任意字符（除了 回车）
- *：代表前面的字符出现0次或者多次
- .* 匹配规则： 找到左边界值后，往右边界查找有边界，找到最后面，的右边界，中间的所有数据都被记录下来
- ？：代表非贪婪匹配，找到左边界后，往右查找匹配右边界，只要右匹配的右边界就停止继续查找， 早次查找左边界和右边界

 

### JMeter关联  - 正则表达式提取器

作用：针对 任意格式的响应数据进行提取

位置： 测试计划 - 线程组 - http 请求   - 后置处理器   - 正则表达式提取器

![image-20240912173140623](C:\Users\田园佳\AppData\Roaming\Typora\typora-user-images\image-20240912173140623.png)

- 引用名称： 存放提取出的值的参数名称，供下一个请求引用，如填 title  则可用${tittle}引用它
- 正则表达式：左边界（.*?) 右边界
  - （）括起来的部分就是要提取的
  - . : 匹配任何字符串
  - *：0次或多次
  - ？：不要太贪婪 在找到第一个匹配项后停止
- 模板 ： 用 $$ 引起来，如果在正则表达式中右多个提取值，则可以是$2$$3$$等等，标示解析到的第几个值的title  如：$1$ 标示解析到的第一个值
- 匹配数字：0代表随机取值，-1代代表全部取值，1代表取第一个值
- 缺省值： 如果参数没有取到值，那默认给一个值让它取

练习：

1. 请求http://www.itcast.cn/  获取网页的 title值
2. 请求 https://www.baidu.com/  把获取到的title作为请求参数



练习2

获取传智教育首页的地址，把第5个校区地址作为参数参数（span 为地址的小区）

响应中的地址格式显示：

```html
<p><span>地址</span>上海市浦东新区航头镇航都区18</p>
```



添加 Debug Sample

添加Http请求 -百度 引用第5个地址信息，格式：${变量名_索引}索引从1开始

### Xpath提取器

案例：

//a : 找出所有的a标签

//a[@id='kw'] :找出id = kw  的a 标签

```html
<title>传智教育【官网】-好口碑IT职业教育,好口碑IT培训机构，一样的教育，不一样的品质</title> 
如果要获取itcast的title 标签使用 //title
```

作用：针对HTML格式响应结果的数据进行提取

位置：添加方式：测试计划 - 线程组 - http请求 - 后置处理器 - Xpath提取器



![image-20240912192303453](E:\Software-Testing\软件测试\接口测试\img\image-20240912192303453.png)

参数介绍：

- Use Tidy(tolerant parser)
  - 当前要处理的页面市html格式，必须勾选
  - 当前要处理的页面是xml或xhtml格式 取消选中该选项
- 引用名称
  - 存放提取出的值的参数名称
- xpath Query 
  - 用于他提取值的Xpath表达式
- 匹配数字
  - 如果xpath 路径查询出许多结果，则可以选择提取那个
  - 0 表示随机  -1 标示提取所有结果  1标示第一个值
- 缺省值
  - 参数的默认值

练习：请求：http://www.itcast.cn  获取网页的title值

​	请求 https://www.baidu.com/ 把获取到的title作为请求参数



1. 什么时候可以使用 XPATH提取器？
   - 针对HTML格式的响应数据，可以使用XPATH 提取器进行提取
2. 添加http请求
3. 使用”xpath提取器“的操作步骤？
   - 添加线程组
   - 添加http请求
   - 添加 xpath提取器
     - 勾选 use tidy
     - 引用名称： 存放提取的值的参数名 
     - xpath query 用于提取xpath表达式
     - 匹配数字  0 标示随机  -1 标示提取所有结果  1 标示第一个值
4. 添加 http 请求
   - 引用正则表达式中的引用名称 如：${title} 引用它

### JMeter关联  - json提取器

作用：针对json格式的响应结果数据进行提取

位置： 添加方式： 测试计划  -  线程组 -http请求  - 后置处理器 - json提取器

![image-20240912202116612](E:\Software-Testing\软件测试\接口测试\img\image-20240912202116612.png)

### JMeter 关联 - JMeter 属性 

JMeter属性的配置函数

——setProperty: 将值**保存**成 JMeter 属性

![image-20240912203725104](E:\Software-Testing\软件测试\接口测试\img\image-20240912203725104.png)

——property函数 在其他线程中使用property函数**读取**属性

![image-20240912203744025](E:\Software-Testing\软件测试\接口测试\img\image-20240912203744025.png)

JMeter 属性的函数执行：

——setProperty 函数执行（保存JMeter属性）

——需要通过BeanShell取样器来执行

1. 什么时候使用JMeter属性？
   - 要实现跨线组的数据传递时，可以使用JMeter属性
2. 使用JMeter属性的操作
   - 添加线程组1
   - 添加http请求 - 天气
   - 添加JSON提取器
   - 添加BeanShell 取样器（赋JSON提取的值保存保存为JMeter属性）__setProperty
     -  保存JMeter属性 
   - 添加线程组2
   - 添加HTTP请求-百度 读取JMeter属性
     - __property



# JMeter 录制脚本

如果有API文档时，可以根据API文档的定义来编写http接口测试脚本

JMeter录制脚本：在没有接口文档的旧项目当中，快速录制web页面项目的http接口请求，帮助编写接口测试脚本

录制时，JMeter作为代理服务器来拦截和转发请求与响应数据

JMeter录制脚本的操作步骤

- 添加http代理服务器，并进行配置
  - 添加http代理服务器：测试计划 - 非测试元件 - http代理服务器
- 配置代理服务器参数
- ![image-20240912212702453](E:\Software-Testing\软件测试\接口测试\img\image-20240912212702453.png)
- 开启windows操作系统的浏览器代理
- ![image-20240912213133322](E:\Software-Testing\软件测试\接口测试\img\image-20240912213133322.png)

# JMeter 连接数据库

直连数据库的使用场景

- 做请求的参数化   
  - 例如登录需要的用户名，可以从数据库中查询获取
- 做断言
  - 例如 添加购物车下订单，检查接口返回的订单，是否与数据库中生成的订单号一致
- 清理垃圾数据
  - 添加商品（商品名/编号等不能重复出现）在执行该脚本不能成功，需要在下次执行前删除该商品数据
- 准备测试数据
  - 例如：通过数据库来准备大量（几十万条）的性能测试数据



### JMeter 直连数据库

- 添加mysql驱动jar包

  - 方式1 在测试计划面板点击浏览按钮  将JDBC驱动添加进来
  - 方式2 将mysql驱动jar包放入到 lib/ext目录下，重启JMter

- 配置数据库连接信息

  - 添加方式  测试计划 - 线程组 -  配置元件 -  JDBC Connection Configuration

  ![image-20240912224847162](E:\Software-Testing\软件测试\接口测试\img\image-20240912224847162.png)



JMeter直连数据库

- 用户请求参数化
- 用做结果的断言
- 清理测试数据
- 准备测试数据

# JMeter 逻辑控制器

逻辑控制器：可以按照设定的逻辑控制取样器的执行顺序

JMeter 中常见的逻辑控制器:

- if 控制器
- 循环控制器
- Foreach控制器

### if循环

js 语法形式  "${name}" == "itcast"

![image-20240913095928273](E:\Software-Testing\软件测试\接口测试\img\image-20240913095928273.png)

函数形式  ${__jex13("${name}" == "baidu"}}   // 使用____ jexl3函数

![image-20240913100200736](E:\Software-Testing\软件测试\接口测试\img\image-20240913100200736.png)

练习：使用用户定义的变量   定义一个变量 name name 的值可以时baidu 或者 itcast

根据name 的变量实现对应网站的访问

### 循环控制器

![image-20240913101815925](E:\Software-Testing\软件测试\接口测试\img\image-20240913101815925.png)

例如：循环访问百度10次

操作步骤

- 添加线程组
- 添加循环控制器
- 添加http请求
- 添加查询结果树

思考线程组属性可以控制循环次数 那么循环控制器有什么作用？

- ​	控制的作用域不同 
  - 线程组 控制的是线程组下的所有请求，控制器控制逻辑控制器下的所有请求
  - 循环控制器 只能控制循环控制器子节点发送请求

### JMeter 逻辑控制器  foreach 控制器

（与类似于列表的概念）

作用：一般和用户自定义的变量或者正则表达式提取器一起使用，读取返回结果中的一系列相关的变量值，该控制器下的取样器都会被执行一次或多次，每次读取不同的变量值



![image-20240913103713349](E:\Software-Testing\软件测试\接口测试\img\image-20240913103713349.png)

练习：

1. 有一组关键字 [hello,python,测试]，使用用户定义的变量存储
2. 要依次取出关键字，并在百度搜索，列如：https://www.baidu.com/S?wd=hello



ForEach控制器的作用是什么？

- 一般和用户自定义变量或者正则表达式提取一起使用，读取返回结果中一系列相关的变量值

使用 ForEach 控制器得到操作步骤？

- 添加线程组
- 添加用户定义的变量/正则表达式提取器
  - 返回一组变量：相同的变量名 + 连续的数字后缀  如：name_1......... name_3
- 添加foreach控制器



# JMeter -定时器  - 同步定时器（测试秒杀，抢红包）

比如说：模拟1w人同时使用电商网站  

​			模拟1w人同时进行电商中的抢购活动/秒杀活动?



同步定时器：阻塞线程（累计一定的请求），当在规定的时间内到达一定的线程数量，这些线程会在同一时间点一起释放，瞬间产生很大的压力 



提示：在JMeter中叫做同步定时器，在Loadrunner 中又叫集合点

位置：测试计划 - 线程组 -http请求 - 定时器 - synchronizing Timer

![image-20240913115724039](C:\Users\田园佳\AppData\Roaming\Typora\typora-user-images\image-20240913115724039.png)

Number of Simulated Users to Group by: 模拟用户的数量，即指定同时释放的线程数量

- 若设置为0，等于设置为线程组中的线程数量

Timeout in milliseconds: 超时时间，即超过多少毫秒后同时释放指定的线程数；

- 如果设置为0  该定时器会等待线程数达到了设置的线程数才释放，若没有达到设置的线程数会一致死等。
- 如果大于0  那么如果超过Timeout in millseconds 中设置的最大数等待时间后还没有达到设置的线程数，Timer 将不再等待，释放已到达的线程。默认为0



练习：模拟100个用户同时访问百度的首页，统计各种并发情况下运行情况

操作步骤：

- 添加线程组，设置线程数=100
- 添加http请求
- 添加同步定时器，并发数可以设置20/30人
- 添加查询结果树
- 添加监听器 - 聚合报告



使用场景：测试抢购 秒杀  抢红包 等高并发的场景时使用



设置超时 时间：

- 建议设置  不设置的化，若没有达到设置的线程数会一致死等
- 不能设置太小： 等待时间后还没有达到设置的线程数，会释放已达到的线程

# 定时器 常数吞吐量定时器（模拟用户真实的业务场景）

作用：让JMeter 按指定的吞吐量执行，以分钟为单位

位置： 测试计划 - 线程组 - http请求  - 定时器  - constant Throughput Timer

![image-20240913145529836](E:\Software-Testing\软件测试\接口测试\img\image-20240913145529836.png)

参数介绍：

 -- Target throughput (in samples per minute) 目标吞吐量 注意这里是每个用户每分钟发送的请求数

 案例需求：

- 模拟用户真实的业务场景要求 20ps
- 如果线程数设置为1 目标吞吐量为 20 *60  = 1200
- 如果线程数设置为2  则目标吞吐量设置为  20 * 60 /2 = 600

需要按指定的吞吐量发送请求时，可以使用常数吞吐量定时器

# 固定定时器

![image-20240913155139363](E:\Software-Testing\软件测试\接口测试\img\image-20240913155139363.png)

例如：有一个oa系统，请求oa系统中所有的请假单的列表信息（结果为json格式，返回请假单的总数和详情信息）并校验是否正确，使用Jmeter测试 步骤

- 添加线程组
- 添加jDBC Connect COnfiguration 配置连接数据库
- 添加 JDBC Request 查询请假列表的总数据
- 添加http 请求  - 请假接口
- 再http请求下 添加json断言  检查 请假列表的总数和JDBC请求查询的请假列表的总数 是否一致
- 添加查询结果树

# JMeter 分布式

- 属性性能分布式测试
- 属性JMeter 的插件 （perfMon)的使用  perfMon 监控资源

在使用JMeter 进行性能测试，如果项目需要支持10000用户并发，单该机单台只能支持1000个用户并发    --- JMeter 分布式测试



JMeter 分布式测试时，选择其中一台作为控制机，其他机器做为代理机

- 执行时，控制机会把脚本发送到每台代理机上
- 代理机拿到脚本后就开始执行，代理机执行时不需要启动JMeter界面，可以理解为他是通过命令行模式执行的
- 执行完成后，代理机会把结果回传给控制机器，控制机器会收集所有代理机的信息并汇总

**分布式相关注意事项**

- 关闭防火墙
- 所有的控制机 代理机 服务器 都在同一个网络上
- JMeter 机器和java 版本必须一致
- 关闭RML  SSL开关

### JMeter 分布式配置和执行

配置： - 修改bin/jmeter.properties文件

- 代理机
  - 修改**服务器端口**：保证每个代机都能够正常启动。如果是在同一台机器上演示要使用不同的端口，堕胎机器可以不修改 例如：server_port = 2999
  - 将RML SSL 设置为 禁用 例如：server.rmi.ssl.disable = true
- 控制机
  - 配置代理机 **远程地址**： 配置每个代理机的 ip+port 多个代理机之间用‘，’连接
  - 例如：remote_hosts = 192.168.183.100:1099,192.168.31.34:2999
  - 将RML SSL设置为禁用。例如server.rmi.ssl.disable = true





**执行**

-代理机（命令行方式启动）

- 进入 bin目录下  运行Jmerer-server.bat文件
- 启动JMeter

-控制器（界面方式启动）：

- 进入bin目录下，运行jmeter.bat文件，启动JMeter
- 选择菜单：运行 - 远程启动 / 远程全部启动



练习：

- 请求：http://www.baidu.com
- 一台控制和两台执行器，做分布式;要求控制器启动，两台执行机执行 反馈结果

操作步骤：

- 配置代理机1 并启动
- 配置代理机2 并启动
- 配置控制机 并启动
- 添加线程组
- 添加http请求 百度
- 添加查看结果树



# JMeter 测试报告  -聚合报告

作用：收集性能测试结束后，系统的各个性能指标。如响应时间，并发数，吞吐量，错误率等

位置：测试计划 - 右键 - 监听器 - 聚合报告

![image-20240913175752324](E:\Software-Testing\软件测试\接口测试\img\image-20240913175752324.png)

补充：

- 正常情况下，响应时间的结果取平均值
- 当响应时间最大值特别高，超出平局水平，导致平均值不能代表正常/大部分时，可以使用百分比时间

![image-20240913181402515](E:\Software-Testing\软件测试\接口测试\img\image-20240913181402515.png)

### JMeter 测试报告的生成  - html 测试报告

作用：JMeter 支持生成 HTml 测试报告 以便于从测试计划中获得图标和统计信息

命令   jmeter -n -t [jmx file] -l [result file] -e -o [html report folder]

eg: jmeter -n -t hollo.jmx -l result.jtl -e -o ./report

- -n 非GUI模式执行JMeter
- -t [jmx file]: 测试计划保存的路劲及.jmx 文件名，路劲可以是相对路径也可以是绝对路径
- -l [result file]: 保存生成测试结果的文件  jtl文件格式
- -e 测试结束后，生成测试报告
- -o [html report folder]: 存放生成的册俄式报告路径，路径可以是相对路径 也可以是绝对路径

注意:result.jet 和  report会自动生成，如果在执行命令时result.jtl 和 report已经存在，必须用先删除，否则在运行命令时就会报告





练习：

- 请求：https://www.baidu.com
- 模拟5个用户并发，控制器QPS为20，运行市场设置为10分钟
- 使用命令行的方式运行，并收集HTML测试报告



聚合报告的核心内容有哪些？

- 响应时间，吞吐量，错误率，网络速度

JMeter 生成html测试报告的命令？

- jmeter -n -t hello.jmx -l result.jtl -e -o ./report

JMeter的HTML测试报告的内容？

- 性能统计仪表盘
- 性能测试过程的详细信息报告



# Jmeter 并发数计算方法

- 掌握性能测试时TPS的计算方法
- 能够用JMeter 来下载第三放插件
- 理解常用的性能测试图表
- 使用PerfMon插件监控服务器资源

为什么需要计算性能测试TPS?

性能测试时的TPS，大都是根据用户真实的业务数据（运营数据）来计算的

**运营数据**：用户使用时的真实数据

TPS 计算机系统每秒事务处理量）

普通计算方法: 

TPS = 总请求数/总时间



只能满足最基本的要求，但是不能覆盖系统正常的使用情况



### 二八原则计算方法：

二八原则就是指 80% 的请求在20% 的时间内完成

计算公式： tps = 总请求数 * 80% / 总时间*20%

满足系统绝大多少场景下的使用



### 性能测试时TPS计算

计算稳定性测试并发量：

并发TPS =  有效请求数*0.8/有效的时间 *0.2

当运营数据越精确时，计算出的并发Tps与实际的越接近



### 压力测试时TPS计算

计算压力测试并发量

TPS = 峰值请求数/峰值时间 * 系数 (系数根据项目组来定)   一般* 2

并发Tps = 峰值请求数/峰值时间*系数

满足峰值请求时间端的负载量，系数取决于项目组对未来业务量的评估



 # JMeter -- 性能监控

Jmeter 下载第三方插件

JMeter自带监控功能无法监控服务器资源

JMeter 自带的报告不精确统计运行过程中的性能指标变化

说明：先下载JMeter插件工具包，再用次包下载JMeter插件

下载插件管理包的步骤：

- 下载包管理工具jar包
- 将包管理工具jar包添加到 JMeter   lib\ext目录下
- 重启JMeter 可以在选项下看到插件管理器

安装第三方插件步骤：

- 打开Plugins Manager 插件管理器
- 选择Available Plugins 当前可用的插件
- 选择需要下载的插件（等待右方文本内容展示出来）
- 下载右下角的下载按钮，自动的完成下载，JMeter会自动重启

安装如下指定的插件

- 3 Basic Graphs
- 5 Additionally Graphs
- Custom Thread Groups
- PerfMon

###  Concurrency Thread Group 线程组

- 阶梯线程组： 作用是阶梯加压，图像界面显示运行状态
- 添加方式： 测试计划 -  线程（用户） - Concurrency Thread Group

![image-20240913212037386](E:\Software-Testing\软件测试\接口测试\img\image-20240913212037386.png)

作用：

- 线程数阶梯上升
- 图形化的展示



### 性能测试常用的图标

### Transactions per Second

每秒完成事务数： 作用是统计事务每秒成功的事务个数  Tps

添加方式： 测试计划  -- 线程组  -- 监听器   - Transactions per Second





### Bytes Throughput per Second

每秒字节吞吐量： 作用是查看服务吞吐流量（单位/字节）

添加方式： 测试计划 - 线程组 - 监听器 - Bytes Throughput over Time

![image-20240913215954991](E:\Software-Testing\软件测试\接口测试\img\image-20240913215954991.png)



### PerfMon 组件监控服务器资源

作用：用来监控服务端的性能资源指标的工具。 包括 cpu 内存 磁盘 网络 等性能数据

添加方法： 线程组 - 监听器  - jp@gc - PerMon Metrics Collector

注意:  使用之前需要在服务器端安装监听服务程序并启动

#### 监听服务器资源指标的步骤：

- 下载安装 ServerAgent-2.2.3.zip 
- 上传到服务器上，并解压ServerAgent-2.2.3
- 启动，如果Windows 运行startAgent.bat   如果是 linux 运行startAgent.sh
- 启动这个工具后，jmeter 的插件jp@gc - PerMon Metrics Collector 就可以收集服务器的资源使用率，并在Jmeter 中查看了

