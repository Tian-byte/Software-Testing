# 性能测试理论

- 性能测试类型
  - 负载测试
  - 稳定性测试
  - 其他
    - 并发测试
    - 压力测试
- 性能测试指标
  - 响应时间
  - 并发数
  - 吞吐量
  - 点击数
  - 错误率
  - 资源使用率

### 为什么要学新能测试

进行性能测试：满足真实的业务场景（活动场景），支持大量的用户。满足商用的需求

- 在真实项目商用时，需要大量的用户进行使用，因此需要模拟大量的使用场景
- 提高薪资

### 性能测试的概念

性能：就是软件质量属性中的“效率”特征

效率特征： 

- 时间特性：表示系统处理用户请求的响应时间
- 资源特性：标示系统运行过程中，系统资源的消耗情况。资源包括：cpu,内存，磁盘等

性能测试：使用自动化工具，模拟不同的场景，对软件各项性能指标进行测试和评价的过程

- 后台处理器的性能（代码性能）
- 应用服务器，数据库，架构设计等是否存在瓶颈
- 服务器资源消耗（cpu,内存，磁盘，网络）

性能测试的目的：

- 评估当前系统功能
  - 验证第三方提供的软件 （鲁大师）
- 寻找性能瓶颈，优化性能
- 评估软件是否能够满足未来的需求

### 功能测试与性能测试

焦点暴不一样

功能测试：验证软件测试系统操作是否否和功能产品需求规格，主要焦点在于功能（正向，逆向）

正向（功能）-- 例如：输入正确的用户密码，登录成功

逆向（功能）：例如 ： 输入错误的用户名密码，登录失败给出提示

性能测试：

​	验证软件系统是否满足业务需求场景，主要焦点是业务场景的满足（时间，资源）

​	例如：

​	100w 人使用正确的用户正确的密码登录 1s可以登录成功 - 时间

​	同时服务器的cpu 使用率低于70% 内存使用率低于60%等  -资源





# 性能测试策略

- 基准测试
- 负载测试
- 稳定性测试
- 其他： 并发测试 压力测试等



 ### 基准测试

狭义上讲：就是单功能测试。测试环境确认以后，对业务模型中的重要业务做单独的测试，获取单用户运行时的各项性能指标

广义上讲：是一种测量和软件性能指标的活动。你可以在某个时刻通过基准测试建立一个已知的性能基准线，当系统的硬件环境发生变换之后在进行一次基准测试以确定对性能的影响

 基准测试数据的用途？

- 基准测试不会单独存在
- 为多用户并发测试和综合场景测试等提供参考
- 为系统/环境配置，系统优化前后性能提升/下降提供参考指标

### 负载测试

（比如双十一用户量增加）

通过逐步增加系统负载，确认满足系统的性能指标情况下，找出系统所能够承载的最大负载量的测试

作用： 系统最大负载量达到用户需求时，系统才能正式上线使用



### 稳定性测试

在服务器稳定运行（用户正常的业务负载下）的情况长时间测试（1天-1周等）并且最终保证服务器能够满足上线业务需求

作用：系统在用户要求的业务负载下运行达到规定的时间，系统才能正式上线

 

### 压力测试

在强负载下的测试，查看系统在峰值情况下是否功能隐患，系统是否具有良好的容错能力和可恢复能力

压力测试：

- 极限情况下导致系统崩溃的破坏压力测试
- 高负载下的长时间的稳定性压力测试

测试场景：

- 极限负载情况下的破坏性压力测试
- 高负载下的长时间的稳定性压力测试



### 并发测试

并发测试（绝对并发） 指在极短的时间内，发送多个请求，来验证服务器对并发的处理能力

应用场景：抢红包，秒杀，抢购等





# 性能测试的指标

- 响应时间
- 并发数
- 吞吐量
- 点击数
- 错误率
- 资源利用率

### **响应时间**：

指用户从客户端发起一个请求开始，到客户端接受到服务器端返回的结果，整个过程所消耗的时间

注意：

- 通过http 接口请求消息来测试
- 不包括 发消息时前端页面的处理时间 和 收到消息后前端页面的渲染显示时间



### **并发数**

某一时刻同时向服务器发送请求的用户数

###  **吞吐量**

吞吐量：指的是单位时间内处理的客户端请求数量，直接体现软件的性能承载能力

- 从业务角度来看：单位：业务数/小时   业务数/天  访问人数/天   页面访问量/天
- 从网络角度来看： 单位： 字节数/小时   字节数/天
- 从技术角度来看：**  单位：每秒事务数（tps)   每秒查询数（QPS)

QPS ： 每秒查询数：即控制服务器每秒处理的指定请求的数量（http)

TPS:  每秒事务数：即控制服务器每秒处理的事务请求的数量

事务：即业务，页面上的一次操作，可以对应一个请求。多个请求



**QPS和TPS有什么关系**

- QPS 每秒的查询数    
- TPS 每秒的业务数

一个事务可以对应一个请求/多个请求

一个事务对应一个请求  即 TPS = QPS

一个事务对应多个请求 即 QPS = nTPS

### **点击数**

点击数：指的是客户端向服务器发送请求，所有的页面资源元素（如：图片，连接，框架css,js 等）的请求总数量

注意：

- 只有web项目才有此指标
- 点击数不是页面上的一次点击

### 错误率

错误率: 指系统在负载情况下，失败业务的概率。错误率 = （失败业务数/业务总数）*100%

注意：

- 大多系统都会要求错误率无限接近于0
- 错误率是一个性能指标，不是功能上的随机bug

### 资源使用率

是指系统各种资源的使用情况，一般用“资源的使用量/总资源的资源可用量* 100% 形成资源利用率的数据

根据经验：资源指标通常要求：

- cpu不高于75%-85%
- 内存不高于 80%
- 磁盘IO不高于90%
- 网络不高于80%

# 性能测试的流程

1. 性能测试需求分析  熟悉需求，获取性能需求指标
2. 性能测试计划及方案
3. 性能测试用例设计
4. 性能测试执行  （建立测试环境，编写测试脚本，性能测试监控，执行测试脚本）
5. 性能分析和调优
6. 性能测试报告总结



### 性能测试需求分析

1. 明确被测系统
   - 熟悉被测系统的业务功能
   - 熟悉被测系统的技术架构
2. 明确测试内容
   - 业务角度 用户使用频率较高的关键
   - 技术角度  逻辑复杂度高的业务  数据量大的业务
3. 明确测试策略
   - 负载测试
   - 稳定性测试
   - 并发测试
4. 明确测试指标
   - 有明确需求指标
     - 执行结果与预期标准进行对比
   - 无明确需求指标（分析指标）
     - 查找资料
     - 类似的系统对比
     - 对未来流量的预估



### 性能测试计划和方案

- 测试的目的和范围
- 测试人员和分工
- 测试时间和安排
- 测试的方法

### 性能测试执行

- 建立测试环境： 
  - 搭建性能测试环境，包括硬件环境，软件环境，网络环境
  - 提示：一般情况下可以要求运维和开发工程师协助完成
- 编写测试脚本
  - 按照性能测试用例的需求，使用性能测试工具进行编写测试脚本
  - 提示： 脚本可以自己编写，也可以使用工具来录制
- 性能测试监控
  - 在执行脚本前 配置各项性能的监控指标
  - 如：响应时间，TPS 错误率 资源使用率（cpu,内存,磁盘）
- 执行测试脚本
  - 设置性能运行场景，执行性能测试，并同步收集各项性能指标
  - 提示： 在执行性能测试脚本之前，保证脚本都调试通过

### 性能分析和调优

指的是 性能测试分析人员经过对结果的分析以后，如果不否和性能需求，则会提出bug,然后由开发人员进行后续的调优

提示：

- 调优：开发人员为主导，数据库管理员，系统管理员，网络管理员，性能测试人员分析人员配合
- 验证： 性能测试人员继续进行第二轮，第三轮.....第三轮的测试结果进行对比，从而确定经过调整以后系统的性能是否有提升

### 性能测试报告总结

包括

- 测试工作二点经过回顾
- 缺陷分析和调优
- 风险评估
- 性能测试结果
- 测试工作总结与改进

  
